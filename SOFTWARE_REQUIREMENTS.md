# ソフトウェア要件（暫定）

本書はアプリの機能・データ・UIなど「ソフトウェア要件」を扱う。前提となるシステム要件は `SYSTEM_REQUIREMENTS.md` を参照。

## コア概念
- 負荷は「強度 × 量」を中心に扱う。
- 強度指標は複数併用（絶対強度・相対強度・主観強度を並列で保持）。
- レストは「成長指標として保存」するが、負荷計算ではデフォルト除外。

## 主要ユーザーシナリオ（MVP）
1) 予定を立てる
- カレンダーから日付を選び、Plan（予定メニュー）を作成する（距離or時間 + 強度）。
- 予定は複数件登録できる（例: 朝夕）。

2) 実績を入力する（予定あり / 予定なし）
- 予定あり: 予定を開き「実施した」を選んでSession（実績）を入力する（Planに紐付け）。
- 予定なし: その日に直接Sessionを追加して記録する。
- 入力は「負荷の算出に必要な最小項目」を優先し、面倒な数値入力はサジェスト/微調整で減らす。

3) 振り返る
- カレンダーの濃淡で負荷の大小を俯瞰し、日詳細・週サマリで集計（総負荷、強度分布、漸進性）を確認する。
- 同一テンプレでレスト短縮などの成長を見られる（詳細は後で拡張）。

## 記録するデータ（MVP）
- セッション（実績）
  - 日付
  - メニュー本体（テンプレ）※インターバルは当面テンプレ入力のみ
  - 量: 走行距離（メニュー本体を基本）
  - 強度:
    - ペース（秒/km）: 絶対強度
    - ペース帯/ゾーン（例: E/M/T/I/R）: 相対強度（PB由来の推定を活用）
    - RPE: 絵文字スライドで選択（数値は内部マッピング）
  - WU/CD（任意・UI入力欄は用意）
    - WU距離/時間（任意）
    - CD距離/時間（任意）
    - 注意: MVPでは分析計算（負荷/統計）に必須としない（主にメモ/任意記録）
  - レスト:
    - レスト時間（必須に近い）
    - レスト距離（ジョグで繋ぐ場合のみ任意）
    - レスト種別（停止/ジョグ）
  - メモ（任意）
- パーソナルベスト（複数入力可能）
  - 種目: 800 / 1500 / 3000 / 3000SC / 5000 / 10000 / ハーフ / フル
  - 記録（任意で日付・メモ）

## 1日のセッション数
- 1日に複数セッション（例: 朝夕の二部練）を許容する。

## 計画（Plan）と実績（Session）の分離
- 予定メニューは事前に立て、当日は「できたか」を入力できる必要がある。
- Plan: 日付、テンプレ（狙い/目標ペースは後で）、メモ
- Session: Planに紐付く実績（未実施/完了/一部/中止などの状態も持つ）
- 予定なし実績も許容（運用上の抜けを吸収）

## 予定/実績の状態（MVP）
- Sessionの状態（例）: `done` / `partial` / `aborted` / `skipped`
  - `done`: 予定どおり（または概ね）実施
  - `partial`: 一部のみ実施
  - `aborted`: 途中中止
  - `skipped`: 未実施（予定はあったが行わなかった）
- カレンダー/集計では、原則として「実績（Session）」を負荷計算の対象とし、未実施は負荷0として扱う。

## 入力UI方針（重要）
- ペース入力の負担を下げる
  - `4:30/km`が直感的だが、分・秒の別入力は避ける
  - 1フィールドで受ける（例: `430`→`4:30/km`、`4:30`も許容）
  - PBから推定したペース帯を「選ぶだけ」で初期値入力（微調整は±秒ボタン/スライダ）
  - ペースは当面「単一入力」をデフォルトとする（範囲入力は後回し）
- RPEは絵文字スライドで「ここらへん」をタップする方式（厳密な数値入力を要求しない）
- テンプレ入力は、入力された欄（例: 種別/本数/距離/レスト等）を起点に「予測入力（サジェスト）」で補完し、手入力量を減らす。

## テンプレ（メニュー本体）の最低限の表現
- まずは「距離または時間」＋「強度」で表現する（入力負担を最小化）。
  - 例（距離）: `12km @E`
  - 例（時間）: `40min @E`
  - 例（インターバル・テンプレ）: `10x1000m @T (rest 60s)` ※詳細は後で拡張

## カレンダーUI
- カレンダーは「メニュー本体」を大きく表示。
- 色分け（濃淡）は「負荷の大きさ」で表現。
- 総距離は負荷とは切り離し、週末/週末尾に軽い統計として表示する程度でよい。
- 1日に複数セッションがある場合は、日セルには「最も負荷が高い1件」を表示し、件数はバッジ等で示す。
- 予定があるが実績がない日:
  - 日セルの文言は予定（Plan）を表示してよい（件数バッジも表示）。
  - 濃淡（色）は「実績が入っている日」を主対象とし、予定のみの日はニュートラル表示（例: 枠線/薄色）で区別する。

## UI・デザイン（洗練）
- **スプラッシュ画面**: アプリ起動時にブランドアイコンと名称を表示し、ロード待機時間を演出。
- **カレンダー画面のヘッダー**: カレンダータブ以外の表示では年月を非表示にし、アプリロゴ/タイトルをスタイリッシュに表示。
- **今日のタブ**: 
  - 各セクションヘッダーに日付（M月d日形式）を併記し、対象日を明確化。
  - 「予定を追加」「実績を入力」ボタンはそれぞれのリスト下部に配置し、フローに沿った導線にする。
- **リスト画面**: 初期表示時に「今日」の日付が最上部に位置するようスクロール位置を自動調整。

## 分析・フィードバック（MVPで狙う）
- 練習距離（主にメニュー本体）、強度、負荷量、漸進性の可視化
- 例: 週負荷、移動平均、強度分布（ゾーン回数/比率）
- レストの成長指標
  - 同一テンプレで「レスト短縮」「停止→ジョグ化」「レスト密度」など

## 負荷計算（暫定方針）
- 複数の負荷算出を並列で保持し、入力できるデータに応じて算出可能なものを使う。
- デフォルト: レストは負荷計算から除外（ただし保存は必須）。
- 濃淡のスケール:
  - 個人の能力（キャパ）に対する相対値が理想
  - 当面は「直近の負荷推移」から能力を推定（例: 42日EWMAなど）
  - 具体式・閾値は運用しながら後で決める

## 代表負荷を算出するための最小入力（MVP）
負荷の可視化が主目的のため、Sessionは原則として「代表負荷が算出できる状態」で保存できることを目指す。

- 推奨入力（時間入力を避ける流れ）:
  - 距離 + ゾーン（E/M/T/I/R）を入れる
  - PBから推定したペース帯を候補提示し、ユーザーは選択/微調整する
  - 結果としてペースが入るため、代表負荷はペース由来で算出できる
- 代替入力（主観中心）:
  - RPE + 時間（分）でsRPEを算出

代表負荷が算出できない場合は保存自体は可能とするが、カレンダー上は「負荷不明」扱いで区別し、追加入力を促す。

## 代表負荷（カレンダー濃淡に使う1つの値）のルール（決定）
- 目的: 複数の負荷指標（ペース由来 / 主観 / 相対）を持ちながら、カレンダー表示や週集計で「基準となる1つの負荷」を決める。
- セッション単位の代表負荷（優先順位）
  1) ペース入力があり、距離または時間がある: ペース由来負荷（例: rTSS風）を代表負荷にする
  2) 上記がないが、RPEと時間がある: sRPE（RPE×時間）を代表負荷にする
  3) 上記がないが、ゾーンと時間がある: ゾーン係数×時間（暫定）を代表負荷にする
  - レストは代表負荷計算からデフォルト除外（ただし保存）
- 日単位の代表負荷（カレンダー色）
  - 日合計（その日の全セッション代表負荷の合計）を色の元にする
  - 日セルの表示文言は「最大負荷の1件」を出す（既定のUI方針と整合）
- 濃淡スケール
  - デフォルト: 直近負荷推移（EWMA等）で能力（キャパ）を推定し、その比率で相対化
  - データ不足時: PB等を使うフォールバック案は `FUTURE_IDEAS.md` に退避済み

## 未決事項（運用で確定）
- PB複数時にどのPB/どの期間を基準にするか（重み付け、直近優先など）
- RPE（絵文字）と内部値の対応、および濃淡の閾値（固定/分位など）の決め方

## 完了条件チェックリスト
- [x] 主要ユーザーシナリオ（予定→実績→振り返り）が成立する要件が揃っている
- [x] 入力項目（必須/任意）とUI方針（ペース1フィールド、RPE絵文字等）が明記されている
- [x] 代表負荷（案A）と優先順位の決定が明記されている
- [x] 1日複数セッション、WU/CD、レスト（保存と計算扱い）が要件として矛盾なく書かれている
