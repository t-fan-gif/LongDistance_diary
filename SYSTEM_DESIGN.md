# システム方式設計（暫定）

本書はシステム設計の内部工程である「システム方式設計」を扱う。要件は `SYSTEM_REQUIREMENTS.md` を参照。
ソフトウェア側の方式設計/詳細設計は `SOFTWARE_ARCHITECTURE.md` / `SOFTWARE_DETAILED_DESIGN.md` を参照。

## システム境界 / 外部I/F
- 対象: 選手個人の練習ログ（Plan/Session/PB）を端末内で記録・閲覧・集計するアプリ。
- 外部I/F（MVP）:
  - 端末内ストレージ（ローカルDB、エクスポートファイル出力）
  - 端末の共有機能（ファイル共有/バックアップ）※OS標準の導線を想定
- エクスポート形式（決定）: JSON
- 対象外（MVP）: アカウント、クラウド同期、チーム共有、ウェアラブル/外部サービス連携（Garmin/COROS/Strava等）。

## 全体アーキテクチャ
- クライアント: Flutter（Androidを先行、将来iOS対応）
- 動作方針: offline-first（端末内で記録・閲覧・集計が完結）
- 構成（概念）: UI（画面）→ アプリケーション層 → 永続化（ローカルDB）/集計

## 対象OSバージョン（MVP）
- Android: 10+（API 29）を想定（MVPでは端末差/権限/ファイル周りの詰まりを減らす）。
- iOS: 将来対応を前提に設計する（将来のターゲットはiOS 15+想定。詳細は後で確定）。

## 技術選定（推奨）
### 決定
- ローカルDB: SQLite + `drift`
- 状態管理: `riverpod`

### 補足（なぜ必要か）
- SQLite: 端末内で「構造化された記録（Plan/Session/PB）」を永続化し、検索・集計（週負荷/移動平均/強度分布など）を安定して行うための土台。
- drift: SQLiteをFlutterから扱いやすくし、型安全なクエリとスキーマ更新（マイグレーション）を提供するために使う。
- riverpod: 画面（UI）とデータ取得/計算（DB・負荷計算）を分離し、依存関係のある画面（カレンダー→日詳細→編集）の更新を安全に行うために使う。

## 主要画面（高レベル）
- カレンダー（月）
  - 日セル: 「最大負荷の1件」＋「件数バッジ」
  - 背景濃淡: 日単位代表負荷（合計）を能力推定で相対化した値
- 日詳細
  - その日のセッション一覧（予定/実績、負荷内訳）
  - 追加/編集への導線
- 予定作成（Plan）
- 実績入力（Session）
- 設定（PB、濃淡スケールの設定、エクスポート等）

## 運用・配布（方針）
- 配布: AndroidはPlay Storeを想定（iOSは将来対応）。
- データ: 端末内に保存（offline-first）。
  - 外部送信（MVP方針）: 自動送信は行わない（分析SDK、クラッシュレポート送信、クラウド同期等は入れない）。
  - 外部送信（例外）: ユーザー操作によるエクスポート/共有は許容（バックアップ/移行目的）。
- バックアップ: OSのバックアップ/ファイル共有導線を使える形でエクスポート（JSON）を提供する。
  - 目的: 端末買い替え/故障時の退避、データ移行、将来の同期機能導入時の移行経路の確保。

## エクスポート（JSON）の範囲（決定）
- 対象: Session（実績）/ Plan（予定）/ PersonalBest（PB）/ 最低限の設定
- 形式: `schema_version` を含め、復元や将来移行に耐える構造とする（詳細は `SOFTWARE_DETAILED_DESIGN.md`）。

## リスク/未決事項（方式設計レベル）
- 初期データ不足時の濃淡スケール（PBフォールバック等）は将来案として扱う（`FUTURE_IDEAS.md`）。
- OSごとのファイル共有UX差（Android/iOS）を吸収する導線設計。

## 完了条件チェックリスト
- [ ] システム境界（対象/対象外）と外部I/Fが明記されている
- [ ] 方式（offline-first、端末内保存）の根拠が要件とトレースできる
- [ ] 対象OSバージョン（Android/iOS方針）が明記されている
- [ ] 採用技術（Flutter/SQLite+drift/riverpod）が「何のためか」説明されている
- [ ] 運用・配布（データ保全/バックアップ導線）の方針がある
- [ ] エクスポート（形式/範囲）が定義されている
- [ ] 主要な未決事項/リスクが列挙されている
